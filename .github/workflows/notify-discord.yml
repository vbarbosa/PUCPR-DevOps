name: Notify Discord

on:
  push:
    branches: [ "main", "develop", "feature/*", "hotfix/*" ]
  pull_request:
    types: [opened, reopened, synchronize, closed]

jobs:
  notify:
    name: ğŸ”” Notify Discord Job
    runs-on: ubuntu-latest
    steps:
      - name: Send notification to Discord
        run: |
          # Detecta mensagem (commit ou PR)
          if [ -n "${{ github.event.head_commit.message }}" ]; then
            MSG="${{ github.event.head_commit.message }}"
          else
            MSG="${{ github.event.pull_request.title }}"
          fi

          # Detecta status da PR (se aplicÃ¡vel)
          if [ "${{ github.event.action }}" = "closed" ] && [ "${{ github.event.pull_request.merged }}" = "true" ]; then
            STATUS="âœ… **PR Mergeado com sucesso!**"
          elif [ "${{ github.event.action }}" = "closed" ]; then
            STATUS="âŒ **PR Fechado sem merge.**"
          elif [ "${{ github.event_name }}" = "push" ]; then
            STATUS="ğŸ“Œ **Novo Push na branch.**"
          else
            STATUS="ğŸ”„ **AtualizaÃ§Ã£o de PR.**"
          fi

          # Envia para o Discord
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{
                 \"content\": \"
                ${STATUS}
                ğŸ“¦ RepositÃ³rio: **${{ github.repository }}**
                ğŸ”¹ Branch: **${{ github.ref_name }}**
                ğŸ‘¤ Autor: **${{ github.actor }}**
                ğŸ“ Mensagem: ${MSG}
                 \"
               }" \
               ${{ secrets.DISCORD_WEBHOOK_URL }}
